# Changelog

All notable changes to this project will be documented in this file.

The format loosely follows [Keep a Changelog](https://keepachangelog.com/en/1.1.0/)
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

- No unreleased changes yet.

## [0.5.0] - 2025-11-30

### Added

#### Location search & map focus

- Wired the Top Bar search input into a real location search flow backed by OpenWeather geocoding.
- Selecting a search result now updates the selected location, opens the Side Panel and recenters the globe on the chosen place with a smooth zoom to a sensible level.
- Extended the map core with a `focusLocation` prop on `MapRoot` so search (and future flows like presets) can drive map camera changes without leaking MapLibre internals across the app.

#### Documentation & contribution workflow

- Added an `ARCHITECTURE.md` that documents the map-centric layout, weather domain boundaries, state stores and the overall frontend layering.
- Added a `README.md` tailored for portfolio usage, including high-level overview, tech stack, feature highlights and local development instructions.
- Added a `CONTRIBUTING.md` with guidelines for local setup, coding style, testing and pull request expectations, aligned with the rest of the portfolio projects.

### Changed

- Refined the global search UX in the Top Bar so that validation and inline error messaging are rendered next to the search field instead of below it, keeping the header compact.
- Updated `MapRoot` tests to match the real default map configuration (Madrid as initial center and zoom level 4) while preserving coverage for viewport emission on load and `moveend`.

### Removed

- Deleted the unused OpenWeather One Call 3.0 integration files, keeping the weather integration strictly focused on the 2.5 APIs that power the current Nimbus Atlas demo.

## [0.4.0] - 2025-11-30

### Added

#### Telemetry & Observability

- Introduced `appTelemetry` as a central sink for app-level events, with a configurable interface and default dev-only console sink.
- Extended `weatherTelemetry` with explicit event shapes for API request/success/error and degraded-data scenarios (hourly, daily, alerts).
- Wired `weatherTelemetry` into the OpenWeather service and weather store so all weather flows emit structured events instead of ad-hoc logging.
- Added dedicated tests for both `appTelemetry` and `weatherTelemetry`, including sink swapping and event dispatch behaviour.

#### Map & UX

- Added a space-themed background (vector starfield) behind the globe to make off-globe areas visually coherent instead of plain black.
- Implemented a base map style toggle (“Map” / “Satellite”) that keeps globe projection always on and only swaps the underlying MapTiler style.
- Added hover feedback for clickable places: the cursor now changes to a pointer only when the map can resolve a nearby city/town/locality.
- Introduced a side panel handle anchored to the panel edge, with an animated chevron icon that reflects open/closed state.
- Added a behaviour for clicks in “space” (outside the visible globe): the current selection is cleared and the Side Panel returns to its empty state.

#### Weather & Side Panel

- Refined the weather section in the Side Panel with clearer loading skeletons and messaging for current conditions and forecast.
- Improved error messaging for current weather failures, surfacing domain-level `WeatherError` messages in a controlled, user-friendly way.

#### Testing

- Expanded `MapRoot` tests to cover:
  - Viewport emission on load and `moveend`.
  - Click behaviour including feature inspection, place metadata extraction and “space” clicks.
- Updated Side Panel location tests to validate the new weather/error/forecast layout and selection lifecycle.
- Strengthened OpenWeather and weather store tests around:
  - Config errors when API key is missing.
  - Network / HTTP / contract error paths.
  - Bundle fan-out and error propagation.
- Added tests for the new telemetry modules to ensure events are emitted to the active sink and that the default sink behaves as expected in dev.

### Changed

- Hardened OpenWeather configuration handling:
  - API key retrieval now trims whitespace and fails fast with a clear config error when missing.
  - Error mapping is stricter, normalising network, HTTP and contract failures into the domain’s `WeatherError` types.
- Updated map initialisation to:
  - Always apply globe projection after style load.
  - Position built-in navigation controls in the top-left, leaving room for the Side Panel handle on the right edge.
- Refined the base map toggle styling and interaction:
  - Animated pill background that slides between “Map” and “Satellite”.
  - Better alignment with the dark glassmorphism map overlay style.
- Adjusted the Side Panel opening rules so:
  - Clicking a location on the globe auto-open panel if it was closed.
  - Clearing selection from a “space” click also shows the empty state within the panel.

### Removed

- Deleted the obsolete `tests/fixtures/openWeatherAlertsFixture.ts` fixture; alert mapping is now exercised through more integrated service/store tests.

## [0.3.0] - 2025-11-29

### Added

#### Map basemap & projection configuration

- Introduced a dedicated map configuration module (`src/config/map.config.ts`) that centralises basemap style selection, default center/zoom and zoom bounds.
- Added support for MapTiler vector styles, with two main presets in code: a dark “streets” basemap optimised for data overlays, and a satellite-hybrid variant.
- Added an explicit `MAP_PROJECTION_TYPE` switch so the map can be rendered either in classic Web Mercator or globe projection (for styles that support it).

#### Side Panel – weather surface

- Enriched the “Selected location” block with a prominent location name + country code (when available) and compact coordinate display.
- Refined the weather summary layout: larger temperature, clearer condition label and a compact row for humidity and wind.
- Reworked the forecast section into card-like rows for both “Next hours” and “Next days”, aligned with the design system tokens for radius, spacing and typography.

#### Testing

- Added a focused map store spec (`tests/mapStore.test.ts`) covering viewport updates, selection lifecycle and layer toggling.
- Added Side Panel integration tests (`tests/SidePanel.location.test.tsx`) that exercise the current flow from a selected location through the weather store into the panel UI.

### Changed

- Map core now relies on MapLibre’s built-in navigation controls; custom zoom buttons have been removed from the overlay stack.
- Updated the Side Panel visuals to better match the overall dark theme:
  - Section headings converted to uppercase, small-caps style.
  - Improved spacing rhythm between “Selected location”, “Current weather” and “Forecast”.
  - Forecast skeletons adjusted to mirror the new card layout.
- Adjusted z-index layering so MapLibre’s own controls remain clickable above the Side Panel chrome while still feeling visually integrated.
- Relaxed `openWeatherService` tests to focus on request URL shape and error categories, delegating detailed JSON mapping checks to the adapter-level tests.

### Removed

- Weather alerts rendering from the Side Panel; alerts remain part of the domain and store but are no longer surfaced in this UI surface.
- Obsolete Side Panel integration tests tied to the previous layout and alerts block.

## [0.2.0] - 2025-11-28

### Added

#### Weather Domain Integration & Data Contracts

- Integrated the weather domain model into the frontend, using canonical entities (`CurrentWeather`, `ForecastTimeline`, `WeatherAlert`, `WeatherBundle`, etc.) aligned with the internal domain documentation.
- Implemented an OpenWeather-based weather provider (`OpenWeatherService`) on top of One Call API 3.0, including URL builder, request helpers and mapping from provider JSON into the domain model.
- Normalised units, timestamps and condition codes (`WeatherConditionCode`) so the rest of the app stays provider-agnostic and does not depend on OpenWeather-specific details.
- Added a TTL-based `weatherStore` with bundle fan-out (current, forecast and alerts) and in-flight request deduplication per location key.
- Connected the map interaction to live weather: clicking on a map location now triggers a weather bundle fetch and exposes the result in the Side Panel.

#### Weather Telemetry & Degraded Data Tracking

- Added weather telemetry helpers to track OpenWeather API usage:
  - Request, success and error events including timing and location metadata.
  - Degraded-data events when forecasts or alerts cannot be mapped cleanly to the domain model.
- Wired the telemetry into `OpenWeatherService.fetchWeatherBundle`, so weather-related behaviour is visible in observability tools.

#### Testing

- Added fixtures for OpenWeather One Call responses to drive adapter and service tests.
- Added unit tests for:
  - Mapping current conditions, hourly/daily forecasts and alerts from OpenWeather JSON into domain entities.
  - `OpenWeatherService.fetchWeatherBundle` success and failure modes (config, network, HTTP and contract errors).
- Added store-level tests for the weather store:
  - Bundle caching and TTL behaviour.
  - In-flight request deduplication per location.
  - Error propagation across current/forecast/alerts resources when the bundle fetch fails.
- Added a Side Panel integration test that covers the `map → weatherStore → UI` flow for selected locations.

## [0.1.0] - 2025-11-28

Initial changelog entry.

### Added

#### Product & Domain Framing 

- Defined the product vision and map-centric positioning of Nimbus Atlas.
- Established the core meteorological domain model (locations, snapshots, forecasts, alerts, layers) and provider-agnostic contracts.
- Documented high-level API contracts and integration boundaries for external weather and geocoding providers.

#### UX Flows & Design System Foundations 

- Defined five key user journeys (UJ1–UJ5) around current conditions, exploration, search, layers and error/empty handling.
- Closed the SPA navigation model with the map as the primary surface across desktop, tablet and mobile.
- Established the first version of the design system: color/typography/spacing/radius tokens and a catalog of base UI components (TopBar, SidePanel, LayersPanel, LegendBar, buttons, inputs, feedback components, etc.).
- Captured global UX patterns for loading/empty/error, accessibility, responsive breakpoints and motion fundamentals.

#### Phase 3 – Frontend Skeleton & Map Core (code)

- Created the `nimbus-atlas` frontend project using Vite, React and TypeScript, with basic tooling and scripts for development, build and tests.
- Implemented the App Shell with:
  - A top bar (brand placeholder, global search input, settings/action area).
  - A main map area that fills the viewport.
  - A floating side panel placeholder used as the first “details” surface.
- Introduced a minimal router with:
  - Main map route (`/`).
  - Settings route and a generic Not Found view.
- Implemented the initial Map Core (`MapRoot`) using MapLibre GL JS:
  - Map initialization with a sensible default center and zoom.
  - Pan/zoom interactions handled by the map engine.
  - Click events translated into neutral `onMapClick` callbacks carrying coordinates.
  - A demo marker + “selected location” overlay to prove the map ↔ UI event flow.
- Added basic UI state to:
  - Track the currently selected location from map clicks.
  - Toggle the visibility of the layers panel without remounting the map.
- Wired a simple map layout and overlays:
  - Layer toggle button and panel as floating overlays on top of the map.
  - Coordinates/status overlay showing the last selected location.

### Testing

- Set up Vitest and React Testing Library for unit and component tests.
- Added base tests for:
  - App Shell layout (top bar, map area and side panel rendering).
  - MapRoot mounting and `onMapReady` callback execution.
  - MapRoot click handling via simulated events.

### Internal

- Aligned the frontend repository structure with the architecture and phase documents (features-based layout, map-centric core, minimal state layer), preparing the ground for Phase 4 (Weather Domain Integration & Data Contracts).
